<!DOCTYPE html>
<html ng-app="app">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,minimal-ui">
		<meta name="format-detection" content="telephone=no">
		<link rel="stylesheet" href="css/iconfont.css">
		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/style.css">
	</head>
	<body>
		<div id="root" class="container">
			<div class="m-article-action">
				<div class="article-action-mid" id="action-mid"></div>
			</div>
			<div id="top-nav" class="top-nav" style="display: none;">
				<div class="icon-back"></div>
				<div class="nav-title">返回书架</div>
			</div>
			<div id="fiction_chapter_title"></div>
			<div id="fiction_container" class="m-read-content">
				<h4>第一百二十八章 通灵</h4>
				<p>
					她名雨紫陌，一声青衣，随风翩然飞舞，肌体晶莹，睫毛很长，双眸灵动而深邃，宛若画中人，长的很漂亮，且有一种罕见的灵性。

					雨族众人都是一呆，他们深知，双杰之一的雨紫陌天赋异禀，有通灵神觉，有时候可以莫名洞悉一段因果。

					谁也说不出这是怎样一种神能，族中每一个人都对她很敬服，若非有石毅那等人物存在，她必然会显得更加璀璨夺目。

					小不点并不知道这些，也不会在意，他镇定自若，端坐九头狮子被背上，冷静的看着这些人，准备大战。
				</p>
				<p>
					“他跟石毅一般，看不透，望不穿，被一股雾霭笼罩。”雨紫陌开口，声音动听，若珠玉坠入清泉中，溅起晶莹的水花，轻和而灵动。

					“他杀了我雨族十八位高手，紫陌你一定要将他擒住。”湖边几人同时开口，大步走来，欲相助她一臂之力。

					他们对这名十五六岁的少女非常信服，知晓她很强，举手投足，一颦一笑皆有神异的力量，这是一个通灵的少女。

					“我自然会出手，盘坐通道前就是等他到来。”雨紫陌开口，她身为雨族中的一员，长辈有命，让她进入百断山全力阻杀一人，自当遵从。

					仅一瞬间，雨紫陌的气质不同了，一片青色的字出现，烙印在她身后的虚空中，古色古香，宛若一片斑驳古卷打开。

					这是一片通灵的字符，散发朦胧光辉，每一个字都有立体感。且似乎有生命，释放着一股难以言喻的力量。

					“好，紫陌快出手，将他擒杀！”

					众人皆大喜。知道自家堂妹动用了大神通，这在平日间很少见，一年半载都难以看她展露一回。
				</p>
				<p>
					小不点坐在九头狮子上，岿然不动。平静的看着，然而眼眸中却有了逼人的光彩，在他心中只要是敌人就没有任何区别，管你什么身份与来头。

					“封！”

					雨紫陌轻喝，声音宛若在九天之外传来，柔和中带着一丝清冽，弥漫着一股杀气。她莹白右臂一挥，身后成片的符震动，绽放璀璨霞光。而后迅速向前飞去！

					这些字符个个晶莹。每一个都像是以精金铸成。熠熠生辉，闪动金属光泽，且有无尽古意。威势惊人。

					“轰！”

					小不点出手，他自然不会被动等着攻击。十指齐张，十根粗大的金色闪电劈出，在这些符间穿行，噼啪作响，不断轰鸣，传出爆碎的声响。

					不少符被闪电击中，在虚空中化成烟花，绚烂而美丽，散发着惊人的能量波动。

					然而，这像是一张斑驳古卷，承载了岁月的力量，近乎不朽。所有符磨灭后，竟又在原地再生，又一次镇压而下。

					四面八方，符成片，密密麻麻，宛若神明的咒语，洒落而下，一幅古卷悬挂苍穹上，封住了天空。
				</p>
				<p>
					一种恐怖的波动出现，虽然平缓，不甚剧烈，但是却如瀚海在慢慢起伏，随时会爆发出滔天的怒浪，将那乌云都要击散。

					小不点心中一凛，伸出双手，用力地合在了一起，在他的前方出现一对银色的磨盘，合在一起，缓缓转动。

					“喀嚓”声不绝于耳，银色磨盘在碾压符，破灭那密密麻麻的符号，想击穿这片封印的光幕。

					“一世画卷！”

					雨紫陌轻喝，这一次声音清亮，响彻天地，她浑身发光，无比炽盛，道音隆隆，瞬间让此地元气剧烈震动了起来。

					在虚空中，字符成片，一张古卷铺展开来，渐渐真实显化，愈发的凝实，宛若上苍的封魔卷，要将小不点他们封住。

					九头狮子变色，这个少女宝术诡异而强大，居然这般特别，它摇头摆尾，准备动用宝具而进行自保。

					小不点轻叱，他不敢大意，沐浴银辉，被一轮月盘笼罩，双手推动那对银色的大磨盘缓缓前进，要将粉碎画卷，破灭封印。

					“轰”

					银色磨盘击天，与画卷撞在一起，各种神秘符号闪耀，宛若诸天星辰。

					“封！封！封！”少女连续轻喝，通体晶莹，被各种古字所缭绕，她几乎要离地而起飞了起来。

					“开！”小不点也大吼，气冲斗牛，目露金光，满头发丝倒竖，气质大变，凌厉而强绝。

					犹如彗星撞进大海，这里爆发出了滔天波澜，不同的是，这里的浪涛是由符构建而成，更为恐怖，席卷四方。

					雨族的其他天才皆逃，远离此地，怕被卷进漩涡中。

					天空中，道光飞舞，符交织，雷鸣声不绝，那斑驳古卷铺展，宛若一挂银河，越发璀璨了。

					而那银色磨盘也剧烈抖动，而后两块盘石分开，竟然猛地撞在了一起，轰隆一声爆发出一团银色的光团，宛若火山喷涌，冲向高天。

					天摇地动，大湖汹涌，山林隆隆作响！
				</p>
			</div>
			<div class="m-button-bar">
				<ul class="u-tab">
					<li class="prev_button">上一章</li>
					<li class="next_button">下一章</li>
				</ul>
			</div>
			<div class="nav-panel-bk font-container" style="display: none;"></div>
			<div class="nav-panel font-container" id="font-container" style="display: none;">
				<div class="child-mod">
					<span>字号</span>
					<button id="large-font" class="font-size-button">大</button>
					<button id="small-font" class="font-size-button">小</button>
				</div>
				<div class="child-mod">
					<span>背景</span>
					<ul class="bk-container-wrap">
						<li class="bk-container" data-color="1">
							<div class="bk-container-current" style="display: none;"></div>
						</li>
						<li class="bk-container" data-color="2">
							<div class="bk-container-current"></div>
						</li>
						<li class="bk-container" data-color="3">
							<div class="bk-container-current" style="display: none;"></div>
						</li>
						<li class="bk-container" data-color="4">
							<div class="bk-container-current" style="display: none;"></div>
						</li>
						<li class="bk-container" data-color="5">
							<div class="bk-container-current" style="display: none;"></div>
						</li>
					</ul>
				</div>
			</div>
			<ul id="bottom-nav" class="bottom-nav" style="display: none;">
				<li id="menu-button"><i class="iconfont icon-icon"></i><div class="icon-text">菜单</div></li>
				<li id="font-button"><i class="iconfont icon-zitifont5"></i><div class="icon-text">字体</div></li>
				<li id="night-button">
					<div id="night_icon" style="display: none;">
						<i class="iconfont icon-yejian"></i><div class="icon-text">夜间</div>
					</div>
					<div id="day_icon">
						<i class="iconfont icon-baitian"></i><div class="icon-text">白天</div>
					</div>
				</li>
			</ul>
		</div>
			<script src="lib/zepto.min.js"></script>
		<script>
			window.jQuery = $;
		</script>
		<script src="js/jquery.base64.js"></script>
		<script src="js/jquery.jsonp.js"></script>

		<script>
			(function () {
				var Util = (function () {
				    var prefix = 'html5_reader_';
					var StorageGetter = function (key) {
						return localStorage.getItem(prefix + key);
                    };
                    var StorageSetter = function (key, val) {
						return localStorage.setItem(prefix + key, val);
                    };
                    var getBSONP = function (url, callback) {
						return $.jsonp({
							url: url,
							cache: true,
							callback: 'duokan_fiction_chapter',
							success: function (result) {
								var data = $.base64.decode(result);
								var json = decodeURIComponent(escape(data));
								callback(data)
                            }
						})
                    };
                    return {
                        getBSONP: getBSONP,
                        StorageGetter: StorageGetter,
                        StorageSetter: StorageSetter
					}
                })();
				var Dom = {
                    top_nav: $('#top-nav'),
                    bottom_nav: $('#bottom-nav'),
                    night_icon: $('#night_icon'),
                    day_icon: $('#day_icon'),
                    font_container: $(".font-container"),
                    bk_container: $('.bk-container')
				};
				var Win = $(window);
				var Doc = $(document);
				var RootContainer = $('.m-read-content');
				var initFontSize = parseInt(Util.StorageGetter('font-size')) || 14;
                RootContainer.css('font-size', initFontSize);

                // 背景色
				var bgColor1 = '#fff';
				var bgColor2 = '#e5dec1';
				var bgColor3 = '#9e9e9e';
				var bgColor4 = '#d0ebd0';
				var bgColor5 = '#232d45';
				var initBackground = Util.StorageGetter('background');
                RootContainer.css('background', initBackground);


				function main() {
					// todo 入口函数
                    var  readerModel = ReaderModel();
                    readerModel.init();
                    EventHanlder()
                }



				function ReaderModel() {
					// todo 实现和阅读器相关的数据交互的方法
                    var Chapter_id;
                    var init = function () {
                        getFictionInfo(function () {
                            getCurChapterContent(Chapter_id, function () {
                                // todo
                            })
                        })
                    };

					var getFictionInfo = function (callback) {
						$.get('data/chapter.json', function (data) {
						    // 获得章节信息
                            Chapter_id = data.chapters[1].chapter_id;
                            console.log(Chapter_id);
                            callback && callback()
                        }, 'json')
                    };

					var getCurChapterContent = function (chapter_id, data) {
						$.get('data/data' + chapter_id +'.json', function (data) {
							if(data.result == 0){
							    var url = data.jsonp;
								Util.getBSONP(url,function (data) {
									 callback && callback(data)
                                })
							}
                        }, 'json')
                    };

                    return {
                        init: init
					}
                }

                function ReaderBaseFrame() {
					// todo 渲染基本的UI结构
                }

                function EventHanlder() {
					// todo 交互的事件绑定
					$('#action-mid').click(function () {
						if (Dom.top_nav.css('display') == 'none') {
							Dom.bottom_nav.show();
                            Dom.top_nav.show();
						} else {
                            Dom.bottom_nav.hide();
                            Dom.top_nav.hide();
                            Dom.font_container.hide();
						}
                    });

					$('#font-button').click(function () {
						if(Dom.font_container.css('display') == 'none') {
							Dom.font_container.show();
                            $(this).addClass('current');
						} else {
                            Dom.font_container.hide();
                            $(this).removeClass('current');
						}
                    });

					// 放大字体
					$('#large-font').click(function () {
					    if (initFontSize > 20) {
							return;
						}
                        initFontSize +=1;
                        RootContainer.css('font-size', initFontSize);
                        Util.StorageSetter('font-size', initFontSize);
                    });
					// 缩小字体
					$('#small-font').click(function () {
					    if (initFontSize < 10) {
					        return;
						}
                        initFontSize -=1;
                        RootContainer.css('font-size', initFontSize);
                        Util.StorageSetter('font-size', initFontSize);
                    });

					// 切换背景
					$('.bk-container').click(function () {
						if ($(this).attr('data-color') == 1){
                            RootContainer.css('background', bgColor1);
                            Util.StorageSetter('background', bgColor1);
						} else if ($(this).attr('data-color') == 2){
                            RootContainer.css('background', bgColor2);
                            Util.StorageSetter('background', bgColor2);
						} else if ($(this).attr('data-color') == 3){
                            RootContainer.css('background', bgColor3);
                            Util.StorageSetter('background', bgColor3);
						} else if ($(this).attr('data-color') == 4){
                            RootContainer.css('background', bgColor4);
                            Util.StorageSetter('background', bgColor4);
						} else if ($(this).attr('data-color') == 5){
                            RootContainer.css('background', bgColor5);
                            Util.StorageSetter('background', bgColor5);
						}
                        $('.bk-container').find('.bk-container-current').hide();
                        $(this).find('.bk-container-current').show();
                    });

                    $('#night-button').click(function () {
                        // todo 触发背景切换
                        if (Dom.night_icon.css('display') == 'none') {
                            Dom.night_icon.show();
                            Dom.day_icon.hide();
                        } else {
                            Dom.night_icon.hide();
                            Dom.day_icon.show();
                        }
                    });

					Win.scroll(function () {
                        Dom.bottom_nav.hide();
                        Dom.top_nav.hide();
                        Dom.font_container.hide();
                    })
                }

                main()

            })()
		</script>
	</body>
</html>